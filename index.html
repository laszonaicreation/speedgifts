<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speed Gifts | Premium Boutique</title>
    
    <!-- Fonts Import -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ============================================================
           MAIN DESIGN CONFIGURATION (EDIT HERE)
           ============================================================
        */
        :root { 
            /* GLOBAL COLORS */
            --website-bg: #ffffff;
            --text-main: #111111;
            --text-muted: #999999;
            --accent-black: #1a1a1a;
            --border-light: #f5f5f5;
            --wishlist-red: #ff4757;

            /* DETAIL VIEW PAGE SETTINGS */
            --detail-page-bg: #ffffff;
            --detail-name-font: 'Inter', sans-serif; 
            --detail-name-color: #111111;
            --detail-name-weight: 600;
            --detail-name-size-mob: 1.75rem;
            --detail-name-size-desk: 3rem;
            --detail-price-font: 'Inter', sans-serif;
            --detail-price-color: #111111;
            --detail-price-size: 1.5rem;
            --detail-label-color: #b0b0b0;
            --detail-label-font-size: 10px;
            --detail-desc-color: #555555;
            --detail-desc-size: 14px;
            
            --font-main: 'Inter', sans-serif; 
        }
        
        body { 
            font-family: var(--font-main); 
            background-color: var(--website-bg); 
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            letter-spacing: -0.02em;
            line-height: 1.5;
            margin: 0;
            padding: 0;
        }

        .serif-text { font-family: 'Playfair Display', serif; }

        /* DETAIL VIEW CSS CLASSES */
        .detail-view-container { background-color: var(--detail-page-bg); text-align: left; }
        .detail-product-name { font-family: var(--detail-name-font); color: var(--detail-name-color); font-weight: var(--detail-name-weight); font-size: var(--detail-name-size-mob); line-height: 1.2; }
        @media (min-width: 768px) { .detail-product-name { font-size: var(--detail-name-size-desk); } }
        .detail-price-text { font-family: var(--detail-price-font); color: var(--detail-price-color); font-size: var(--detail-price-size); font-weight: 700; }
        .detail-label { font-size: var(--detail-label-font-size); font-weight: 700; letter-spacing: 0.05em; color: var(--detail-label-color); margin-bottom: 4px; display: block; text-transform: uppercase; }
        .detail-description-text { color: var(--detail-desc-color); font-size: var(--detail-desc-size); line-height: 1.6; }

        /* CUSTOMER VIEW - Home Card Styling */
        .product-card h3 { font-size: 13px; font-weight: 600; }
        .price-tag { font-size: 11px; font-weight: 700; color: var(--text-muted); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .brand-logo { font-weight: 900; letter-spacing: 0.25em; font-size: 15px; }
        @media (min-width: 768px) { .brand-logo { font-size: 20px; } }

        .category-item { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; cursor: pointer; width: 78px; transition: 0.3s ease; }
        .category-circle { width: 58px; height: 58px; border-radius: 50%; border: 1px solid var(--border-light); padding: 3px; background: #fff; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); }
        
        /* PREMIUM GOLD & BLACK ANIMATION FOR CATEGORY */
        @keyframes categoryGlow {
            0% { border-color: #111111; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
            50% { border-color: #D4AF37; box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }
            100% { border-color: #111111; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
        }

        .active .category-circle { 
            animation: categoryGlow 2.5s infinite ease-in-out; 
            transform: scale(1.1); 
            border-width: 2px;
        }

        /* PREMIUM BUTTON ANIMATION (GOLD/BLACK LINE EFFECT) */
        @keyframes buttonPremiumGlow {
            0% { border-color: rgba(0,0,0,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
            50% { border-color: #D4AF37; box-shadow: 0 5px 25px rgba(212, 175, 55, 0.3); }
            100% { border-color: rgba(0,0,0,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        }
        .premium-btn-anim {
            animation: buttonPremiumGlow 3s infinite ease-in-out;
            border-width: 1.5px;
        }

        .category-label { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 10px; color: var(--text-muted); text-align: center; }

        .img-container { aspect-ratio: 3/4; overflow: hidden; background: #fafafa; border-radius: 12px; border: 1px solid var(--border-light); position: relative; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 1.2s ease; }

        /* MOBILE HIDE SELECTION UI */
        @media (max-width: 767px) {
            .select-btn { display: none !important; }
            #selection-bar { display: none !important; }
            .desktop-select-actions { display: none !important; }
        }

        .select-btn { position: absolute; top: 8px; right: 8px; width: 22px; height: 22px; background: rgba(255,255,255,0.95); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 20; border: 1px solid #eee; transition: 0.3s; }
        .selected .select-btn { background: var(--accent-black); color: #fff; border-color: var(--accent-black); }

        /* WISHLIST BUTTON */
        .wish-btn { position: absolute; top: 8px; left: 8px; width: 22px; height: 22px; background: rgba(255,255,255,0.95); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 21; border: 1px solid #eee; transition: 0.3s; color: #ccc; }
        .wish-active .wish-btn { color: var(--wishlist-red); }

        /* SELECTION BAR - Compact Centered */
        #selection-bar {
            position: fixed;
            bottom: 15px; 
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-black);
            color: #fff;
            padding: 6px 12px; 
            border-radius: 100px;
            display: none; 
            align-items: center;
            justify-content: center;
            gap: 8px; 
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            width: auto;
            min-width: 180px; 
            max-width: 95vw;
            backdrop-filter: blur(15px);
        }

        @keyframes slideUpCenter {
            from { opacity: 0; transform: translateX(-50%) translateY(15px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        .animate-selection { animation: slideUpCenter 0.4s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        .selection-count { font-size: 8.5px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; padding-left: 4px; white-space: nowrap; }
        #selection-bar button { font-size: 8px !important; padding: 4px 10px !important; font-weight: 700; letter-spacing: 0.03em; }

        .thumb-grid { display: flex; gap: 8px; margin-top: 12px; }
        .thumb-box { width: 50px; height: 50px; border-radius: 10px; overflow: hidden; border: 1px solid var(--border-light); cursor: pointer; transition: 0.3s; }
        .thumb-box.active { border-color: var(--accent-black); border-width: 1.5px; }

        /* Admin UI Fixes */
        .admin-input { width: 100%; padding: 0.9rem 1.1rem; background: #f9f9f9; border: 1px solid transparent; border-radius: 12px; font-size: 14px; transition: 0.3s; }
        .admin-input:focus { background: #fff; border-color: var(--accent-black); outline: none; }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeInUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        #toast { position: fixed; bottom: 85px; left: 50%; transform: translateX(-50%); z-index: 10001; display: none; }

        .spec-badge {
            background: #fff;
            border: 1px solid #eee;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            color: #333;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        /* NEW ADMIN LIST STYLING */
        #admin-product-list-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 8px;
        }
        #admin-product-list-container::-webkit-scrollbar { width: 4px; }
        #admin-product-list-container::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }

        .admin-list-category-header {
            background: #fdfdfd;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            margin-top: 25px;
            margin-bottom: 15px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .stock-badge {
            font-size: 8px;
            font-weight: 900;
            text-transform: uppercase;
            padding: 3px 8px;
            border-radius: 4px;
            margin-top: 4px;
            display: inline-block;
        }
        .stock-badge.in { background: #e6fffa; color: #319795; }
        .stock-badge.out { background: #fff5f5; color: #e53e3e; }
    </style>
</head>
<body class="selection:bg-black selection:text-white">

    <div id="toast" class="bg-black text-white px-8 py-4 rounded-xl shadow-2xl text-[10px] font-black tracking-widest uppercase"></div>

    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-gray-50">
        <div class="max-w-7xl mx-auto px-5 h-16 md:h-20 flex items-center justify-between">
            <div class="w-1/4">
                <button id="admin-entry-btn" class="hidden bg-black text-white px-4 py-2 rounded-full text-[8px] font-bold tracking-widest uppercase" onclick="showAdminPanel()">
                    Dashboard
                </button>
            </div>
            <div class="flex-1 text-center">
                <h1 class="brand-logo cursor-pointer select-none uppercase truncate leading-none" id="main-logo" onclick="handleLogoClick()">
                    SPEED GIFTS
                </h1>
            </div>
            <div class="w-1/4 flex justify-end items-center">
                <!-- WISHLIST NAV BUTTON -->
                <button onclick="applyFilter('wishlist')" class="relative flex items-center gap-2 text-gray-400 hover:text-red-500 transition-all group">
                    <span class="hidden md:block text-[9px] font-black tracking-widest uppercase group-hover:text-red-500 transition-all">Favorites</span>
                    <div class="relative">
                        <i class="fa-solid fa-heart text-xl"></i>
                        <span id="nav-wishlist-count" class="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-[7px] font-black w-4 h-4 flex items-center justify-center rounded-full border-2 border-white hidden">0</span>
                    </div>
                </button>
            </div>
        </div>
    </nav>

    <main id="app" class="max-w-7xl mx-auto px-5 pt-4 pb-48 min-h-screen">
        <div id="loader" class="flex flex-col items-center justify-center py-64">
            <div class="w-6 h-6 border-2 border-gray-100 border-t-black rounded-full animate-spin"></div>
            <p class="mt-6 text-[10px] font-black uppercase tracking-[0.25em] text-gray-400 animate-pulse">Loading Speed Gifts Catalogue</p>
        </div>
    </main>

    <!-- Templates -->
    <div id="home-view-template" class="hidden">
        <div id="selection-header" class="hidden mb-10 fade-in">
            <div class="flex flex-col gap-4 border-b border-gray-100 pb-8">
                <div class="space-y-1">
                    <h2 class="text-xl font-black tracking-tight uppercase" id="view-title">Picked for you</h2>
                    <p class="text-[12px] text-gray-400" id="view-subtitle">Exclusive items curated for your boutique experience.</p>
                </div>
                <button onclick="goBackToHome(true)" class="text-[9px] font-bold uppercase tracking-widest px-6 py-3 bg-black text-white rounded-full shadow-lg self-start">View All Products</button>
            </div>
        </div>
        
        <div id="category-selector-container" class="mb-4 fade-in">
            <p class="text-[9px] font-black uppercase tracking-[0.2em] text-gray-300 px-1">Select Category</p>
        </div>

        <div id="category-row" class="no-scrollbar flex gap-4 overflow-x-auto py-8 items-center border-b border-gray-50 mb-10 px-1"></div>
        
        <div class="desktop-select-actions flex justify-between items-center mb-6 hidden md:flex">
            <h3 id="active-category-title" class="text-[11px] font-black uppercase tracking-[0.15em] text-gray-400 px-1"></h3>
            <button id="select-all-btn" onclick="toggleSelectAll()" class="text-[8.5px] font-black uppercase tracking-widest py-2 px-4 rounded-full border border-gray-100 bg-gray-50 hover:bg-black hover:text-white transition-all text-gray-400">
                Select All Visible
            </button>
        </div>

        <div class="md:hidden mb-6 px-1">
            <h3 id="active-category-title-mob" class="text-[10px] font-black uppercase tracking-[0.15em] text-gray-400"></h3>
        </div>

        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-12 md:gap-x-8 md:gap-y-20"></div>
    </div>

    <div id="selection-bar">
        <span class="selection-count" id="selected-count">0 items</span>
        <div class="h-4 w-px bg-white/20"></div>
        <div class="flex gap-2">
            <button onclick="shareSelection()" class="bg-white/10 text-white px-3 py-2 rounded-full border border-white/10 whitespace-nowrap">Copy link</button>
            <button onclick="sendBulkInquiry()" class="bg-white text-black px-3 py-2 rounded-full shadow-lg">WhatsApp</button>
        </div>
        <button onclick="clearSelection()" class="text-white opacity-40 hover:opacity-100 text-sm ml-1 pr-1"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden fixed inset-0 z-[60] bg-white overflow-y-auto">
        <div class="max-w-6xl mx-auto px-8 py-20">
            <div class="flex justify-between items-center mb-16">
                <div><h2 class="text-3xl font-black tracking-tight uppercase">Workspace</h2><p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-1">Cloud Inventory Manager</p></div>
                <button onclick="hideAdminPanel()" class="w-12 h-12 flex items-center justify-center rounded-full bg-gray-50 text-gray-400 hover:text-black transition-all">âœ•</button>
            </div>
            
            <div class="flex p-1 bg-gray-50 rounded-2xl mb-12 max-w-sm border border-gray-100 shadow-inner">
                <button onclick="switchAdminTab('products')" id="tab-p" class="flex-1 py-4 rounded-xl text-[10px] font-bold uppercase transition-all bg-white shadow-xl">Products</button>
                <button onclick="switchAdminTab('categories')" id="tab-c" class="flex-1 py-4 rounded-xl text-[10px] font-bold uppercase text-gray-400">Categories</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
                <div class="lg:col-span-5">
                    <!-- Product Section -->
                    <div id="admin-product-section" class="fade-in">
                        <div class="bg-gray-50 p-8 rounded-[2rem] border border-gray-100 space-y-4 shadow-sm">
                            <h3 id="p-form-title" class="text-[11px] font-black uppercase tracking-widest">Product Details</h3>
                            <input type="hidden" id="edit-id">
                            <input type="text" id="p-name" class="admin-input" placeholder="Item Name">
                            <input type="text" id="p-price" class="admin-input" placeholder="Price (AED 50)">
                            <select id="p-cat-id" class="admin-input cursor-pointer"></select>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="p-size" class="admin-input" placeholder="Size">
                                <input type="text" id="p-material" class="admin-input" placeholder="Material">
                            </div>

                            <label class="flex items-center gap-3 bg-white p-4 rounded-xl border border-gray-100 cursor-pointer">
                                <input type="checkbox" id="p-stock" class="w-4 h-4 accent-black" checked>
                                <span class="text-[11px] font-bold uppercase tracking-widest text-gray-500">Available in Stock</span>
                            </label>

                            <div class="bg-white/60 p-4 rounded-xl border border-gray-100 space-y-4">
                                <input type="text" id="p-img" class="w-full bg-transparent outline-none text-sm font-semibold" value="img/" placeholder="Image Path 1">
                                <input type="text" id="p-img2" class="w-full bg-transparent outline-none text-sm font-semibold" value="img/" placeholder="Image Path 2">
                                <input type="text" id="p-img3" class="w-full bg-transparent outline-none text-sm font-semibold" value="img/" placeholder="Image Path 3">
                            </div>
                            <textarea id="p-desc" rows="4" class="admin-input" placeholder="Product description..."></textarea>
                            <button onclick="saveProduct()" id="p-save-btn" class="w-full bg-black text-white py-5 rounded-2xl font-bold text-[11px] uppercase tracking-widest shadow-2 mt-4">Sync Product</button>
                        </div>
                    </div>
                    <!-- Category Section -->
                    <div id="admin-category-section" class="hidden fade-in">
                        <div class="bg-gray-50 p-8 rounded-[2rem] border border-gray-100 space-y-4 shadow-sm">
                            <h3 id="c-form-title" class="text-[11px] font-black uppercase tracking-widest">New Category</h3>
                            <input type="hidden" id="edit-cat-id">
                            <input type="text" id="c-name" class="admin-input" placeholder="Category Title">
                            <input type="text" id="c-img" class="admin-input" value="img/" placeholder="Icon Path">
                            <button onclick="saveCategory()" id="c-save-btn" class="w-full bg-black text-white py-5 rounded-2xl font-bold text-[11px] uppercase tracking-widest shadow-2 mt-4">Sync Category</button>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-7">
                    <div id="admin-list-controls" class="mb-6 space-y-4">
                        <h4 id="list-title" class="text-[11px] font-bold uppercase tracking-widest text-gray-300 italic">Live Inventory</h4>
                        <div id="product-admin-filters" class="flex flex-col md:flex-row gap-3">
                            <div class="flex-1 relative">
                                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-300 text-xs"></i>
                                <input type="text" id="admin-search" oninput="renderAdminUI()" class="admin-input pl-10 py-3 !bg-gray-50 border border-gray-100" placeholder="Search product name...">
                            </div>
                            <select id="admin-cat-filter" onchange="renderAdminUI()" class="admin-input py-3 !bg-gray-50 border border-gray-100 md:w-48 text-xs font-bold uppercase">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="admin-product-list-container">
                        <div id="admin-product-list" class="space-y-4 fade-in"></div>
                    </div>
                    <div id="admin-category-list" class="hidden space-y-4 fade-in"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs & Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, updateDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBzAGimDQCeuV4oMEQhhUBH8tbsQjBf9hc",
            authDomain: "cataloguedata-9b2be.firebaseapp.com",
            projectId: "cataloguedata-9b2be",
            storageBucket: "cataloguedata-9b2be.firebasestorage.app",
            messagingSenderId: "191169887154",
            appId: "1:191169887154:web:08319d5f3898ed22db02ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = firebaseConfig.projectId;

        const prodCol = collection(db, 'artifacts', appId, 'public', 'data', 'products');
        const catCol = collection(db, 'artifacts', appId, 'public', 'data', 'categories');
        const shareCol = collection(db, 'artifacts', appId, 'public', 'data', 'selections');

        let DATA = { p: [], c: [] };
        let state = { filter: 'all', user: null, selected: [], wishlist: [], selectionId: null, scrollPos: 0 };
        let clicks = 0, lastClickTime = 0;

        const startSync = async () => {
            try { await signInAnonymously(auth); } 
            catch (err) { console.error(err); }
        };

        onAuthStateChanged(auth, async (u) => {
            state.user = u;
            if (u) {
                await loadWishlist();
                refreshData();
            }
        });

        window.onpopstate = () => {
            refreshData(true);
        };

        async function loadWishlist() {
            if (!state.user) return;
            try {
                const wishDoc = await getDoc(doc(db, 'artifacts', appId, 'users', state.user.uid, 'data', 'wishlist'));
                if (wishDoc.exists()) {
                    state.wishlist = wishDoc.data().ids || [];
                    updateWishlistBadge();
                }
            } catch (err) { console.error("Wishlist Load Error"); }
        }

        function updateWishlistBadge() {
            const badge = document.getElementById('nav-wishlist-count');
            if (!badge) return;
            const count = state.wishlist.length;
            if (count > 0) {
                badge.innerText = count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        window.toggleWishlist = async (e, id) => {
            e.stopPropagation();
            if (!state.user) return showToast("Authenticating...");
            
            const card = e.target.closest('.product-card');
            if (state.wishlist.includes(id)) {
                state.wishlist = state.wishlist.filter(x => x !== id);
                if (card) card.classList.remove('wish-active');
            } else {
                state.wishlist.push(id);
                if (card) card.classList.add('wish-active');
            }

            updateWishlistBadge();

            try {
                await setDoc(doc(db, 'artifacts', appId, 'users', state.user.uid, 'data', 'wishlist'), { ids: state.wishlist });
                if (state.filter === 'wishlist') renderHome();
            } catch (err) { showToast("Sync Error"); }
        };

        async function refreshData(isNavigationOnly = false) {
            try {
                if (!isNavigationOnly || DATA.p.length === 0) {
                    const [pSnap, cSnap] = await Promise.all([getDocs(prodCol), getDocs(catCol)]);
                    DATA.p = pSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                    DATA.c = cSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                }
                
                const urlParams = new URLSearchParams(window.location.search);
                const shareId = urlParams.get('s');
                const prodId = urlParams.get('p');

                const isAdminOpen = !document.getElementById('admin-panel').classList.contains('hidden');

                if (!isAdminOpen) {
                    if (prodId && DATA.p.length > 0) {
                        viewDetail(prodId, true);
                    } else if (shareId) {
                        const selDoc = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'selections', shareId));
                        if (selDoc.exists()) {
                            state.selectionId = shareId;
                            state.selected = selDoc.data().ids;
                            renderHome();
                        }
                    } else {
                        renderHome();
                    }
                } else {
                    const appArea = document.getElementById('app');
                    if (appArea.querySelector('#product-grid')) renderHome();
                }
                
                populateCatSelect();
                populateAdminCatFilter();
                renderAdminUI();

                // ROBUST IMAGE PRELOADING
                const loader = document.getElementById('loader');
                if (loader && loader.style.display !== 'none') {
                    const currentProdId = new URLSearchParams(window.location.search).get('p');
                    let imagesToWait = [];

                    if (currentProdId) {
                        const p = DATA.p.find(x => x.id === currentProdId);
                        if (p) imagesToWait = [p.img, p.img2, p.img3].filter(u => u && u !== 'img/');
                    } else {
                        // Wait for visible icons + first 8 products
                        const icons = DATA.c.map(c => c.img);
                        const products = DATA.p.filter(p => p.inStock !== false).slice(0, 10).map(p => p.img);
                        imagesToWait = [...icons, ...products].filter(u => u && u !== 'img/');
                    }

                    if (imagesToWait.length > 0) {
                        const promises = imagesToWait.map(url => {
                            return new Promise((resolve) => {
                                const img = new Image();
                                img.src = url;
                                img.onload = () => {
                                    if ('decode' in img) {
                                        img.decode().then(resolve).catch(resolve);
                                    } else {
                                        resolve();
                                    }
                                };
                                img.onerror = resolve; // Continue even if one fails
                                // Timeout protection
                                setTimeout(resolve, 5000);
                            });
                        });
                        await Promise.all(promises);
                    }
                    
                    // Final small delay to let UI settle
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 150);
                }
            } catch (err) { console.error(err); showToast("Sync Error"); }
        }

        const safePushState = (params) => {
            try {
                const url = new URL(window.location.href);
                url.searchParams.delete('p');
                if (params.s === null) url.searchParams.delete('s');
                Object.keys(params).forEach(key => {
                    if (params[key] !== null) url.searchParams.set(key, params[key]);
                });
                window.history.pushState({}, '', url.search);
            } catch (e) {
                console.warn("Navigation state restricted.");
            }
        };

        window.handleLogoClick = () => {
            const now = Date.now();
            if (now - lastClickTime > 2500) clicks = 0;
            clicks++; lastClickTime = now;
            if (clicks >= 5) {
                const btn = document.getElementById('admin-entry-btn');
                if (btn) { btn.classList.remove('hidden'); showToast("Dashboard Unlocked"); }
                clicks = 0;
            }
            goBackToHome(false);
        };

        window.goBackToHome = (forceReset = false) => {
            if (forceReset) {
                state.selectionId = null;
                state.selected = [];
                state.filter = 'all';
                state.scrollPos = 0;
                safePushState({ s: null, p: null });
            } else {
                safePushState({ p: null });
            }
            renderHome();
        };

        window.toggleSelectAll = () => {
            if (state.selectionId) return;
            const stockFilter = (items) => items.filter(p => p.inStock !== false);
            let currentVisible = [];
            if (state.filter === 'wishlist') {
                currentVisible = DATA.p.filter(p => state.wishlist.includes(p.id));
            } else if (state.filter !== 'all') {
                currentVisible = stockFilter(DATA.p.filter(p => p.catId === state.filter));
            } else {
                currentVisible = stockFilter(DATA.p);
            }
            const visibleIds = currentVisible.map(p => p.id);
            const allVisibleSelected = visibleIds.every(id => state.selected.includes(id));
            if (allVisibleSelected) {
                state.selected = state.selected.filter(id => !visibleIds.includes(id));
            } else {
                state.selected = Array.from(new Set([...state.selected, ...visibleIds]));
            }
            renderHome();
        };

        function renderHome() {
            const appMain = document.getElementById('app');
            const template = document.getElementById('home-view-template');
            if (!appMain || !template) return;
            appMain.innerHTML = template.innerHTML;

            const catRow = document.getElementById('category-row');
            const grid = document.getElementById('product-grid');
            const selectionHeader = document.getElementById('selection-header');
            const viewTitle = document.getElementById('view-title');
            const viewSubtitle = document.getElementById('view-subtitle');
            const selectAllBtn = document.getElementById('select-all-btn');
            const activeCatTitle = document.getElementById('active-category-title');
            const activeCatTitleMob = document.getElementById('active-category-title-mob');
            const categorySelector = document.getElementById('category-selector-container');

            if (state.selectionId) {
                if (selectionHeader) selectionHeader.classList.remove('hidden');
                if (catRow) catRow.classList.add('hidden');
                if (categorySelector) categorySelector.classList.add('hidden');
                if (viewTitle) viewTitle.innerText = "Shared Selection";
                if (viewSubtitle) viewSubtitle.innerText = "Specially picked items for you.";
            } else if (state.filter === 'wishlist') {
                if (selectionHeader) selectionHeader.classList.remove('hidden');
                if (catRow) catRow.classList.add('hidden');
                if (categorySelector) categorySelector.classList.add('hidden');
                if (viewTitle) viewTitle.innerText = "Your Favorites";
                if (viewSubtitle) viewSubtitle.innerText = "Items you've saved to your favorites.";
            } else {
                let cHtml = `<div class="category-item ${state.filter === 'all' ? 'active' : ''}" onclick="applyFilter('all')"><div class="category-circle flex items-center justify-center bg-gray-50 text-[9px] font-black text-gray-300">All</div><p class="category-label">Explore</p></div>`;
                DATA.c.forEach(c => {
                    cHtml += `<div class="category-item ${state.filter === c.id ? 'active' : ''}" onclick="applyFilter('${c.id}')"><div class="category-circle overflow-hidden"><img src="${c.img}" class="w-full h-full rounded-full object-cover" onerror="this.src='https://placehold.co/100x100?text=Gift'"></div><p class="category-label truncate max-w-[70px]">${c.name}</p></div>`;
                });
                if (catRow) catRow.innerHTML = cHtml;
            }

            let filtered = [];
            const stockFilter = (items) => items.filter(p => p.inStock !== false);
            if (state.selectionId) {
                filtered = DATA.p.filter(p => state.selected.includes(p.id));
            } else if (state.filter === 'wishlist') {
                filtered = DATA.p.filter(p => state.wishlist.includes(p.id));
            } else if (state.filter !== 'all') {
                filtered = stockFilter(DATA.p.filter(p => p.catId === state.filter));
            } else {
                filtered = stockFilter(DATA.p);
            }

            let catNameDisplay = "All Collections";
            if (state.selectionId) catNameDisplay = "Shared Selection";
            else if (state.filter === 'wishlist') catNameDisplay = "Favorites List";
            else if (state.filter !== 'all') {
                const catObj = DATA.c.find(c => c.id === state.filter);
                if (catObj) catNameDisplay = catObj.name;
            }
            if (activeCatTitle) activeCatTitle.innerText = catNameDisplay;
            if (activeCatTitleMob) activeCatTitleMob.innerText = catNameDisplay;

            if (selectAllBtn) {
                const visibleIds = filtered.map(p => p.id);
                const allVisibleSelected = visibleIds.length > 0 && visibleIds.every(id => state.selected.includes(id));
                selectAllBtn.innerText = allVisibleSelected ? "Deselect Visible" : "Select Visible Items";
                if (state.selectionId) selectAllBtn.parentElement.classList.add('hidden');
            }

            if (grid) {
                grid.innerHTML = filtered.map(p => `
                    <div class="product-card group fade-in ${state.selected.includes(p.id) ? 'selected' : ''} ${state.wishlist.includes(p.id) ? 'wish-active' : ''}" onclick="viewDetail('${p.id}')">
                        <div class="wish-btn shadow-sm" onclick="toggleWishlist(event, '${p.id}')"><i class="fa-solid fa-heart text-[10px]"></i></div>
                        ${!state.selectionId && !state.filter.includes('wishlist') ? `<div class="select-btn shadow-sm" onclick="toggleSelect(event, '${p.id}')"><i class="fa-solid fa-check text-[10px]"></i></div>` : ''}
                        <div class="img-container mb-4 shadow-sm"><img src="${p.img}" loading="lazy"></div>
                        <div class="px-1 text-left">
                            <h3 class="capitalize truncate leading-none text-gray-900 font-semibold">${p.name}</h3>
                            <p class="price-tag mt-2 font-bold">${p.price} AED</p>
                        </div>
                    </div>
                `).join('') || `<p class="col-span-full text-center py-40 text-gray-300 italic text-[11px]">No items found.</p>`;
            }
            updateSelectionBar();
            if (!state.selectionId && state.filter !== 'wishlist') {
                window.scrollTo({top: state.scrollPos});
            } else {
                window.scrollTo({top: 0});
            }
        }

        window.viewDetail = (id, skipHistory = false) => {
            const p = DATA.p.find(x => x.id === id);
            if (!p) return;
            
            if (!skipHistory) {
                state.scrollPos = window.scrollY;
                safePushState({ p: id });
            }

            const appMain = document.getElementById('app');
            appMain.innerHTML = `
                <div class="max-w-5xl mx-auto py-8 md:py-16 fade-in px-4 pb-64 detail-view-container text-left">
                    <button onclick="goBackToHome()" class="mb-12 text-[10px] font-bold text-gray-400 flex items-center gap-2 uppercase tracking-widest hover:text-black transition-all">
                        <i class="fa-solid fa-arrow-left"></i> Back to ${state.filter === 'wishlist' ? 'Favorites' : (state.selectionId ? 'Selection' : 'Catalogue')}
                    </button>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-start">
                        <div>
                            <div class="aspect-square rounded-[2.5rem] overflow-hidden bg-white border border-gray-100 shadow-2xl">
                                <img src="${p.img}" id="main-detail-img" class="w-full h-full object-cover">
                            </div>
                            <div class="thumb-grid justify-center lg:justify-start">
                                <div class="thumb-box active" onclick="switchImg('${p.img}', this)"><img src="${p.img}"></div>
                                ${p.img2 && p.img2 !== 'img/' ? `<div class="thumb-box" onclick="switchImg('${p.img2}', this)"><img src="${p.img2}"></div>` : ''}
                                ${p.img3 && p.img3 !== 'img/' ? `<div class="thumb-box" onclick="switchImg('${p.img3}', this)"><img src="${p.img3}"></div>` : ''}
                            </div>
                        </div>
                        <div class="py-2">
                            <span class="text-[9px] font-bold text-gray-300 tracking-[0.05em] uppercase mb-8 block">Exclusive Selection</span>
                            <div class="space-y-12">
                                <div><span class="detail-label">Item name:</span><h2 class="detail-product-name capitalize">${p.name}</h2></div>
                                <div class="flex items-center gap-10 mt-8 mb-10 pb-10 border-b border-gray-100">
                                    <div><span class="detail-label">Listing Price</span><p class="detail-price-text">${p.price} AED</p></div>
                                    <div class="h-10 w-px bg-gray-100"></div>
                                    <div><span class="detail-label">Availability</span><p class="text-sm font-bold text-black flex items-center gap-2">
                                        ${p.inStock !== false ? '<span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> In Stock' : '<span class="w-2 h-2 bg-red-500 rounded-full"></span> Out of Stock'}
                                    </p></div>
                                </div>
                                <div class="flex flex-wrap gap-4 mb-12">
                                    ${p.size ? `<div class="spec-badge"><i class="fa-solid fa-maximize text-[10px] text-gray-400"></i><span>${p.size}</span></div>` : ''}
                                    ${p.material ? `<div class="spec-badge"><i class="fa-solid fa-layer-group text-[10px] text-gray-400"></i><span>${p.material}</span></div>` : ''}
                                </div>
                                <div class="mb-14">
                                    <span class="detail-label">Product Story</span>
                                    <p class="detail-description-text mt-4 whitespace-pre-line">${p.desc || 'Premium handcrafted selection curated specifically for our collection.'}</p>
                                </div>

                                <button onclick="inquireOnWhatsApp('${p.id}')" class="hidden md:flex w-full bg-black text-white py-6 rounded-3xl font-bold text-[11px] uppercase tracking-[0.2em] shadow-xl items-center justify-center gap-3 hover:scale-[1.02] transition-all">
                                    <i class="fa-brands fa-whatsapp text-lg"></i>
                                    INQUIRE ON WHATSAPP
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="fixed md:hidden bottom-0 left-1/2 -translate-x-1/2 w-full flex justify-center p-3 z-[70]" style="max-width: 500px;">
                    <div class="w-11/12 bg-white/80 backdrop-blur-xl border border-white/20 p-1.5 rounded-full shadow-[0_10px_40px_rgba(0,0,0,0.15)] premium-btn-anim">
                        <button onclick="inquireOnWhatsApp('${p.id}')" class="w-full bg-black text-white py-3.5 rounded-full font-bold text-[10px] uppercase tracking-[0.15em] flex items-center justify-center gap-3 active:scale-95 transition-all">
                            <i class="fa-brands fa-whatsapp text-lg text-green-400"></i>
                            INQUIRE ON WHATSAPP
                        </button>
                    </div>
                </div>
            `;
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.saveProduct = async () => {
            const id = document.getElementById('edit-id').value;
            const btn = document.getElementById('p-save-btn');
            const data = { name: document.getElementById('p-name').value, price: document.getElementById('p-price').value, size: document.getElementById('p-size').value, material: document.getElementById('p-material').value, inStock: document.getElementById('p-stock').checked, img: document.getElementById('p-img').value, img2: document.getElementById('p-img2').value, img3: document.getElementById('p-img3').value, catId: document.getElementById('p-cat-id').value, desc: document.getElementById('p-desc').value, updatedAt: Date.now() };
            if (!data.name || !data.img) return showToast("Required info missing");
            btn.disabled = true; btn.innerText = "Syncing...";
            try { if (id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id), data); else await addDoc(prodCol, data); showToast("Synced Successfully"); resetForm(); DATA.p = []; refreshData(); } 
            catch (e) { showToast("Save Error"); } finally { btn.disabled = false; btn.innerText = "Sync Product"; }
        };

        window.saveCategory = async () => {
            const id = document.getElementById('edit-cat-id').value;
            const btn = document.getElementById('c-save-btn');
            const data = { name: document.getElementById('c-name').value, img: document.getElementById('c-img').value };
            if (!data.name) return showToast("Name required");
            btn.disabled = true; btn.innerText = "Syncing...";
            try { if (id) await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'categories', id), data); else await addDoc(catCol, data); showToast("Category Synced"); resetForm(); DATA.p = []; refreshData(); } 
            catch (e) { showToast("Category Error"); } finally { btn.disabled = false; btn.innerText = "Sync Category"; }
        };

        window.deleteProduct = async (id) => { if (!confirm("Are you sure?")) return; try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id)); showToast("Deleted"); refreshData(); } catch (e) { showToast("Delete Error"); } };
        window.deleteCategory = async (id) => { if (!confirm("Delete Category?")) return; try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'categories', id)); showToast("Category Removed"); refreshData(); } catch (e) { showToast("Error"); } };

        window.editProduct = (id) => {
            const item = DATA.p.find(x => x.id === id);
            if(!item) return;
            document.getElementById('edit-id').value = item.id;
            document.getElementById('p-name').value = item.name;
            document.getElementById('p-price').value = item.price;
            document.getElementById('p-size').value = item.size || "";
            document.getElementById('p-material').value = item.material || "";
            document.getElementById('p-stock').checked = item.inStock !== false;
            document.getElementById('p-img').value = item.img;
            document.getElementById('p-img2').value = item.img2 || "img/";
            document.getElementById('p-img3').value = item.img3 || "img/";
            document.getElementById('p-cat-id').value = item.catId;
            document.getElementById('p-desc').value = item.desc;
            document.getElementById('p-form-title').innerText = "Editing: " + item.name;
            switchAdminTab('products');
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.editCategory = (id) => {
            const item = DATA.c.find(x => x.id === id);
            if(!item) return;
            document.getElementById('edit-cat-id').value = item.id;
            document.getElementById('c-name').value = item.name;
            document.getElementById('c-img').value = item.img;
            document.getElementById('c-form-title').innerText = "Editing: " + item.name;
            switchAdminTab('categories');
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.toggleSelect = (e, id) => { 
            e.stopPropagation(); 
            const card = e.target.closest('.product-card');
            if (state.selected.includes(id)) { 
                state.selected = state.selected.filter(x => x !== id); 
                if (card) card.classList.remove('selected');
            } else { 
                state.selected.push(id); 
                if (card) card.classList.add('selected');
            } 
            updateSelectionBar(); 
        };

        function updateSelectionBar() {
            const bar = document.getElementById('selection-bar');
            const count = document.getElementById('selected-count');
            if (!bar) return;
            if (state.selected.length > 0 && !state.selectionId && state.filter !== 'wishlist') { bar.style.display = 'flex'; bar.classList.add('animate-selection'); if (count) count.innerText = `${state.selected.length} items`; } 
            else { bar.style.display = 'none'; bar.classList.remove('animate-selection'); }
        }

        window.clearSelection = () => { state.selected = []; state.selectionId = null; renderHome(); };

        window.shareSelection = async () => {
            if (state.selected.length === 0) return;
            showToast("Generating link...");
            try { const docRef = await addDoc(shareCol, { ids: state.selected, createdAt: Date.now() }); const shareUrl = `${window.location.origin}${window.location.pathname}?s=${docRef.id}`; const textArea = document.createElement("textarea"); textArea.value = shareUrl; document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); document.body.removeChild(textArea); showToast("Secret Link Copied!"); } 
            catch (e) { showToast("Sharing failed."); }
        };

        window.sendBulkInquiry = () => {
            const items = state.selected.map(id => DATA.p.find(p => p.id === id)).filter(x => x);
            let msg = `*Hello Speed Gifts!*\nI am interested in these items:\n\n`;
            items.forEach((item, i) => { const pUrl = `${window.location.origin}${window.location.pathname}?p=${item.id}`; msg += `${i+1}. *${item.name}* - ${item.price} AED\nLink: ${pUrl}\n\n`; });
            window.open(`https://wa.me/919000000000?text=${encodeURIComponent(msg)}`);
        };

        window.inquireOnWhatsApp = (id) => {
            const p = DATA.p.find(x => x.id === id);
            const pUrl = `${window.location.origin}${window.location.pathname}?p=${p.id}`;
            const msg = `*Inquiry regarding:* ${p.name}\n*Price:* ${p.price} AED\n\n*Product Link:* ${pUrl}\n\nPlease let me know the availability.`;
            window.open(`https://wa.me/919000000000?text=${encodeURIComponent(msg)}`);
        };

        window.switchImg = (src, el) => { const main = document.getElementById('main-detail-img'); if (main) main.src = src; document.querySelectorAll('.thumb-box').forEach(x => x.classList.remove('active')); if (el) el.classList.add('active'); };

        window.renderAdminUI = () => {
            const pList = document.getElementById('admin-product-list');
            const cList = document.getElementById('admin-category-list');
            if (!pList || !cList) return;
            const searchEl = document.getElementById('admin-search');
            const filterEl = document.getElementById('admin-cat-filter');
            const searchQuery = searchEl ? searchEl.value.toLowerCase() : "";
            const catFilter = filterEl ? filterEl.value : "all";
            let products = DATA.p.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchQuery);
                const matchesCat = catFilter === 'all' || p.catId === catFilter;
                return matchesSearch && matchesCat;
            });
            const grouped = {};
            products.forEach(p => {
                const catName = DATA.c.find(c => c.id === p.catId)?.name || "Uncategorized";
                if (!grouped[catName]) grouped[catName] = [];
                grouped[catName].push(p);
            });
            let pHtml = "";
            Object.keys(grouped).sort().forEach(cat => {
                pHtml += `<div class="admin-list-category-header"><h5 class="text-[10px] font-black uppercase tracking-widest text-gray-400">${cat} (${grouped[cat].length})</h5></div>`;
                grouped[cat].forEach(p => {
                    const stockTag = p.inStock !== false ? '<span class="stock-badge in">In Stock</span>' : '<span class="stock-badge out">Out of Stock</span>';
                    pHtml += `<div class="flex items-center gap-4 p-4 bg-gray-50 rounded-2xl border border-gray-100 group"><img src="${p.img}" class="w-12 h-12 rounded-xl object-cover shadow-sm border border-white"><div class="flex-1"><h4 class="font-bold text-[12px] capitalize truncate">${p.name}</h4><p class="text-[9px] text-gray-400 font-bold">${p.price} AED</p>${stockTag}</div><div class="flex gap-2"><button onclick="editProduct('${p.id}')" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-md text-gray-400 hover:text-black transition-all"><i class="fa-solid fa-pen text-[9px]"></i></button><button onclick="deleteProduct('${p.id}')" class="w-8 h-8 flex items-center justify-center bg-red-50 rounded-full text-red-200 hover:text-red-500 transition-all"><i class="fa-solid fa-trash text-[9px]"></i></button></div></div>`;
                });
            });
            pList.innerHTML = pHtml || `<p class="text-center py-20 text-[11px] text-gray-300 italic">No products found matching filters.</p>`;
            cList.innerHTML = DATA.c.map(c => `<div class="flex items-center gap-5 p-5 bg-gray-50 rounded-[2rem] border border-gray-100"><img src="${c.img}" class="w-14 h-14 rounded-full object-cover border-4 border-white shadow-sm" onerror="this.src='https://placehold.co/100x100?text=Icon'"><div class="flex-1 font-bold text-[13px] uppercase">${c.name}</div><div class="flex gap-2"><button onclick="editCategory('${c.id}')" class="w-10 h-10 flex items-center justify-center bg-white rounded-full shadow-lg text-gray-400 hover:text-black transition-all"><i class="fa-solid fa-pen text-[10px]"></i></button><button onclick="deleteCategory('${c.id}')" class="w-10 h-10 flex items-center justify-center bg-red-50 rounded-full text-red-200 hover:text-red-500 transition-all"><i class="fa-solid fa-trash text-[10px]"></i></button></div></div>`).join('') || `<p class="text-center py-20 text-[11px] text-gray-300 italic">No Categories</p>`;
        };

        window.applyFilter = (id) => { state.filter = id; state.scrollPos = 0; renderHome(); };
        window.showAdminPanel = () => { document.getElementById('admin-panel').classList.remove('hidden'); document.body.style.overflow = 'hidden'; renderAdminUI(); };
        window.hideAdminPanel = () => { document.getElementById('admin-panel').classList.add('hidden'); document.body.style.overflow = 'auto'; };
        
        window.switchAdminTab = (tab) => {
            const isProd = tab === 'products';
            document.getElementById('admin-product-section').classList.toggle('hidden', !isProd);
            document.getElementById('admin-category-section').classList.toggle('hidden', isProd);
            document.getElementById('admin-product-list-container').classList.toggle('hidden', !isProd);
            document.getElementById('admin-category-list').classList.toggle('hidden', isProd);
            document.getElementById('product-admin-filters').classList.toggle('hidden', !isProd);
            document.getElementById('tab-p').className = isProd ? "flex-1 py-4 rounded-xl text-[10px] font-bold uppercase bg-white shadow-xl" : "flex-1 py-4 rounded-xl text-[10px] font-bold uppercase text-gray-400";
            document.getElementById('tab-c').className = !isProd ? "flex-1 py-4 rounded-xl text-[10px] font-bold uppercase bg-white shadow-xl" : "flex-1 py-4 rounded-xl text-[10px] font-bold uppercase text-gray-400";
            document.getElementById('list-title').innerText = isProd ? "Live Inventory" : "Existing Categories";
        };

        function populateCatSelect() {
            const select = document.getElementById('p-cat-id');
            if (select) select.innerHTML = `<option value="">Category Selection</option>` + DATA.c.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        function populateAdminCatFilter() {
            const select = document.getElementById('admin-cat-filter');
            if (select) select.innerHTML = `<option value="all">All Categories</option>` + DATA.c.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        window.resetForm = () => {
            const fields = ['edit-id', 'edit-cat-id', 'p-name', 'p-price', 'p-size', 'p-material', 'p-desc', 'c-name'];
            fields.forEach(f => { const el = document.getElementById(f); if (el) el.value = ""; });
            document.getElementById('p-img').value = "img/"; 
            document.getElementById('p-img2').value = "img/";
            document.getElementById('p-img3').value = "img/";
            document.getElementById('c-img').value = "img/";
            document.getElementById('p-stock').checked = true;
            document.getElementById('p-form-title').innerText = "Product Details";
            document.getElementById('c-form-title').innerText = "New Category";
            if (document.getElementById('admin-search')) document.getElementById('admin-search').value = "";
            if (document.getElementById('admin-cat-filter')) document.getElementById('admin-cat-filter').value = "all";
        };

        function showToast(msg) {
            const t = document.getElementById('toast'); if (!t) return;
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 3000);
        }

        startSync();
    </script>
</body>
</html>